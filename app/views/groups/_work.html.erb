<div class="work">
  <%if @group.user_exists?(current_user, @group) %>
    <h3>データ</h3>
    <div class="data">
      <% if @today_my_target == 0 %>
        <%= form_with(model: [@group, @target], local: true) do |f| %>
          <%= f.hidden_field :user_id, :value => current_user.id %>
          <%= f.hidden_field :group_id, :value => @group.id %>

          <div class="area">
            <div>一日一回、記入してください！</div>
            <%= f.text_area :target_content, placeholder: "今日の目標を一言！", class: "text_area"%>
          </div>

          <div class="field">
            <%= f.submit "今日の目標登録", class: "big_btn" %>
          </div>
        <%end%>
      <%else%>
        <div>今日の目標は記入済みです！</div>
      <%end%>
    </div>

    <div class="calendar">
      カレンダー未設定
    </div>

    <div class="target">
      <h1>今日の目標</h1>
      <table border="1">
        <thead>
          <tr>
            <th>ユーザーネーム</th><th>目標</th><th>達成%</th>
          </tr>
        </thead>
        <tbody>
          <% @today_targets.each do |target| %>
            <tr>
              <td><%= target.user.name %></td>
              <td>
                <% if target.user_id == current_user.id %>
                  <%= link_to target.target_content, edit_group_target_path(@group, target.id) %>
                <%else%>
                  <%= target.target_content %>
                <%end%>
              </td>
              <td>
                <% if target.achievement_by?(target) %>
                  <% if target.user_id == current_user.id %>
                    <!--リザルト投稿済み＆自分の投稿で、editリンクを表示-->
                    <%= link_to target.result.achievement, edit_target_result_path(target, target.result.id) %>
                  <%else%>
                    <%= target.result.achievement %>
                  <%end%>
                <%else%>
                  <!--リザルト未投稿の場合-->
                  <% if target.user_id == current_user.id %>
                    <%= form_with(model: [target, @result], local: true) do |f| %>
                      <%= f.hidden_field :target_id, :value => target.id %>
                      <%= f.hidden_field :user_id, :value => current_user.id %>
                      <%= f.hidden_field :group_id, :value => @group.id %>
                      <div class="area">
                        <%= f.text_field :achievement, placeholder: "0~100" %>
                      </div>
                      <div class="field">
                        <%= f.submit "登録" %>
                      </div>
                    <%end%>
                  <%else%>
                    <div>未記入</div>
                  <%end%>
                <%end%>
              </td>
            </tr>
          <%end%>
        </tbody>
      </table>
    </div>

    <div class="memo">
      <h3>今日の取り組み結果メモ</h3>
      <table border="1">
        <thead>
          <tr>
            <th>ユーザーネーム</th>
            <th>取り組み結果メモ</th>
          </tr>
        </thead>
        <tbody>
          <% @today_targets.each do |target| %>
            <tr>
              <td><%= target.user.name %></td>
              <td>
                <% if target.result_memo_exists?(target) %>
                  <%= target.result.result_memo %>
                <%else%>
                  (メモはありません)
                <%end%>
              </td>
            </tr>
          <%end%>
        </tbody>
      </table>
    </div>

    <div class="graph">
      <h3>一週間達成度比較</h3>
      <%= column_chart @results.pluck(:created_at, :achievement), class: "graph_size" %>
    </div>

    <!--グループに自分が居て、かつ編集ステータスがない人に、退会ボタンを表示-->
    <div class="leave">
      <% if @group.user_exists?(current_user, @group) && @my_group_status.operation_right == 0 %>
        <%= link_to group_group_member_path(@group, current_user.id), method: :delete, data: {confirm: "このグループを退会します。本当によろしいですか？"}, class: "edit_link" do %>
          <div class="red_btn">グループ退会</div>
        <%end%>
      <%else%>
        ＊退会不可能です
      <%end%>
    </div>


  <%else%>
  <!--このグループのメンバーでない場合の表示-->
  <div class="join">
    <div>メンバーではないため、情報を閲覧することができません！</div>
    <% if @group.direct_join == true %>
      <div class="action">
        <%= form_with(url: direct_group_group_member_path(@group.id), model:[@group, @direct_join], local: true) do |f| %>
          <%= f.submit "加入", class: "big_btn" %>
        <%end%>
        <div>＊すぐに加入できます！</div>
      </div>


    <%else%>
      <!--加入申請がすでに送られている場合は、加入申請を送れない-->
      <% unless @group.entry_exists?(current_user) %>
        <%= form_with(model:[@group, @entry], local: true) do |f| %>
          <%= f.hidden_field :user_id, :value => current_user.id %>
          <%= f.hidden_field :group_id, :value => @group.id %>
          <div class="action">
            <%= f.submit "加入", class: "big_btn" %>
            <div>＊加入申請を送信します！</div>
          </div>
        <%end%>
      <%else%>
        <div>申請を送りました！承諾された場合、グループを利用することができます！</div>
      <%end%>
    <%end%>
  </div>
  <%end%>
</div